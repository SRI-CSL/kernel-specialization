This folder gathers scripts used for using OCCAM's razor on the Linux kernel.

## How to use the scripts

Make sure you have [OCCAM](https://github.com/SRI-CSL/OCCAM) installed.

You need to provide the full path to the bitcode built after running the ["built-in-parsing.py"](../kernel-to-bitcode/built-in-parsing.py).

The second argument is the syscall list. If you have generated a specialized list of system calls
(e.g from the examples directory) use that. Otherwise use the [full syscall.list](syscall.list).


```
./slash_kernel.sh {full-path-to-bitcode-build} {syscall-list}
```
## Step-by-Step 

First you need to build the Linux kernel and generate its bitcode using the [kernel-to-bitcode guide](../kernel-to-bitcode/README.md). 

Once the bitcode has been generated, copy the [script](generateExclusionSymbols.py) for generating exclusion symbols (symbols that are defined in modules and used in native_libs and symbols that have weak definitions) to the directoty where the bitcode modules and native_libs are copied.


```
cp generateExclusionSymbols.py {full-path-to-bitcode-build}/.
cd {full-path-to-bitcode-build}
```

The [script](generateExclusionSymbols.py) above takes as input the manifest file (kernel-manifest.json) and the name of the file to which you want the exclusion symbols to be written(exclusion_list). 

```
python generateExclusionSymbols.py kernel-manifest.json exclusion_list
```

Now you need to update the exclusion_list with the system call list with respect to which you want to specialize. If you have generated a specialized list of system calls(e.g from the examples directory) use that. Otherwise use the [full syscall.list](syscall.list).


```
cat {syscall-list} >> exclusion_list 

```

And now we are ready to slash the kernel with OCCAM with respect to the above exclusion_list.

```
OCCAM_LOGFILE=occam.log slash --work-dir=slashing --keep-external=exclusion_list kernel-manifest.json
```

The above command will generate the specialized versions of all the bitcodes. However, it will fail in generating the "vmlinux" file. The "compile_occam_final.sh" script generated by ["built-in-parsing.py"](../kernel-to-bitcode/built-in-parsing.py) is used for this purpose.


```
./compile_occam_final.sh
```

And we are done. The "vmlinux" file is a version specialized with respect to the specified syscall list. It can be installed using instructions in [kernel-to-bitcode guide](../kernel-to-bitcode/README.md).

